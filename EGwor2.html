<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>智慧英文辭典查詢</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 30px; }
    .result-box { margin-top: 20px; }
    .history { font-size: 0.9em; color: gray; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">📘 智慧英文辭典查詢</h1>
    <div class="input-group mb-3">
      <input type="text" id="wordInput" class="form-control" placeholder="輸入英文單字">
      <button class="btn btn-primary" onclick="lookupWord()">查詢</button>
      <button class="btn btn-secondary" onclick="toggleLanguage()">切換語言</button>
    </div>

    <div class="result-box" id="resultBox"></div>
    <div class="history mt-4" id="historyBox"></div>
  </div>

  <script>
    let currentLang = 'zh';
    const apiKey = 'YOUR_API_KEY'; // ← 請替換成你的 WordsAPI 金鑰
    const history = [];

    function toggleLanguage() {
      currentLang = currentLang === 'zh' ? 'en' : 'zh';
      document.querySelector('h1').textContent = currentLang === 'zh' ? '📘 智慧英文辭典查詢' : '📘 Smart English Dictionary';
      document.getElementById('wordInput').placeholder = currentLang === 'zh' ? '輸入英文單字' : 'Enter English word';
      document.querySelector('.btn-primary').textContent = currentLang === 'zh' ? '查詢' : 'Search';
      document.querySelector('.btn-secondary').textContent = currentLang === 'zh' ? '切換語言' : 'Switch Language';
      updateHistory();
    }

    async function lookupWord() {
      const word = document.getElementById('wordInput').value.trim();
      if (!word) return;

      const resultBox = document.getElementById('resultBox');
      resultBox.innerHTML = currentLang === 'zh' ? '查詢中...' : 'Searching...';

      const url = `https://wordsapiv1.p.rapidapi.com/words/${word}`;
      try {
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'X-RapidAPI-Key': apiKey,
            'X-RapidAPI-Host': 'wordsapiv1.p.rapidapi.com'
          }
        });
        const data = await response.json();

        if (data.word) {
          history.unshift(data.word);
          updateHistory();

          let html = `<h2>${data.word} <button class="btn btn-sm btn-outline-dark" onclick="speak('${data.word}')">🔊</button></h2>`;

          if (data.results) {
            html += `<h4>${currentLang === 'zh' ? '定義' : 'Definitions'}:</h4><ul>`;
            data.results.forEach(r => html += `<li>${r.definition}</li>`);
            html += `</ul>`;

            const synonyms = data.results.flatMap(r => r.synonyms || []);
            if (synonyms.length > 0) {
              html += `<h4>${currentLang === 'zh' ? '同義詞' : 'Synonyms'}:</h4><p>${[...new Set(synonyms)].join(', ')}</p>`;
            }

            const examples = data.results.flatMap(r => r.examples || []);
            if (examples.length > 0) {
              html += `<h4>${currentLang === 'zh' ? '例句' : 'Examples'}:</h4><ul>`;
              examples.forEach(e => html += `<li>${e}</li>`);
              html += `</ul>`;
            }
          }

          resultBox.innerHTML = html;
        } else {
          resultBox.innerHTML = currentLang === 'zh' ? '查無此單字。' : 'Word not found.';
        }
      } catch (error) {
        resultBox.innerHTML = currentLang === 'zh' ? '查詢失敗，請檢查 API 金鑰或網路連線。' : 'Search failed. Check API key or connection.';
        console.error(error);
      }
    }

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
    }

    function updateHistory() {
      const historyBox = document.getElementById('historyBox');
      if (history.length === 0) {
        historyBox.innerHTML = '';
        return;
      }
      const title = currentLang === 'zh' ? '🔍 最近查詢：' : '🔍 Recent Searches:';
      historyBox.innerHTML = `${title} ${history.slice(0, 5).join(', ')}`;
    }
  </script>
</body>
</html>
